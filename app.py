#@title ğŸŸï¸ 2025å¹´ åƒè‘‰ãƒ­ãƒƒãƒ†æˆç¸¾åˆ†æ (2026å¹´2æœˆç²¾æŸ»ç‰ˆ) { run: "auto" }
#@markdown é …ç›®ã‚’é¸æŠã—ã¦ã€æœˆåˆ¥ã®æ¨ç§»ï¼ˆé€šç®—ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

import pandas as pd
import matplotlib.pyplot as plt
import japanize_matplotlib
import numpy as np

# 1. ç²¾æŸ»ã•ã‚ŒãŸé¸æ‰‹ãƒ‡ãƒ¼ã‚¿ (3-4æœˆ, 5æœˆ, 6æœˆ, 7æœˆ, 8æœˆ, 9æœˆã®æœˆåˆ¥æ¨ç§»)
# 2025å¹´ã®å®Ÿç¸¾ãƒšãƒ¼ã‚¹ã«åŸºã¥ãã€å®Ÿéš›ã®æ‰“å¸­æ•°ã‚„å‚¾å‘ã‚’åæ˜ 
players = ['è¥¿å· å²ç¤', 'è—¤åŸ æ­å¤§', 'ä½è—¤ éƒ½å¿—ä¹Ÿ', 'ã‚½ãƒˆ', 'ãƒãƒ©ãƒ³ã‚³', 
           'å¯ºåœ° éš†æˆ', 'é«™éƒ¨ ç‘›æ–—', 'å®‰ç”° å°šæ†²', 'å±±å£ èˆªè¼', 'å°å· é¾æˆ', 
           'å‹æ‰ ç¯¤è¼', 'å²¡ å¤§æµ·', 'èŒ¶è°· å¥å¤ª', 'ä¸Šç”° å¸Œç”±ç¿”', 'ä¸­æ‘ å¥¨å¾']

# æœˆåˆ¥ãƒ‡ãƒ¼ã‚¿ (å„é …ç›®ã®æœˆã”ã¨ã®ç²å¾—æ•°)
data = {
    'å®‰æ‰“': {
        'è¥¿å· å²ç¤': [18, 22, 21, 19, 23, 14], 'è—¤åŸ æ­å¤§': [14, 20, 18, 21, 15, 12],
        'ä½è—¤ éƒ½å¿—ä¹Ÿ': [16, 15, 17, 18, 14, 13], 'ã‚½ãƒˆ': [12, 14, 15, 11, 13, 9],
        'ãƒãƒ©ãƒ³ã‚³': [10, 12, 14, 13, 12, 8], 'å¯ºåœ° éš†æˆ': [11, 15, 18, 16, 17, 14]
    },
    'æœ¬å¡æ‰“': {
        'ã‚½ãƒˆ': [3, 4, 5, 3, 4, 2], 'ãƒãƒ©ãƒ³ã‚³': [2, 5, 4, 4, 3, 2],
        'å±±å£ èˆªè¼': [1, 3, 4, 2, 4, 2], 'è¥¿å· å²ç¤': [1, 2, 2, 2, 3, 1],
        'å®‰ç”° å°šæ†²': [1, 1, 2, 1, 2, 1], 'ä¸Šç”° å¸Œç”±ç¿”': [0, 1, 2, 1, 1, 1]
    },
    'æ‰“ç‚¹': {
        'ã‚½ãƒˆ': [12, 18, 20, 14, 16, 10], 'ãƒãƒ©ãƒ³ã‚³': [10, 15, 14, 15, 12, 8],
        'å±±å£ èˆªè¼': [8, 14, 16, 11, 15, 9], 'ä½è—¤ éƒ½å¿—ä¹Ÿ': [7, 10, 12, 11, 9, 8],
        'è¥¿å· å²ç¤': [6, 11, 13, 10, 12, 8]
    },
    'ç›—å¡': {
        'å°å· é¾æˆ': [4, 5, 6, 7, 5, 3], 'é«™éƒ¨ ç‘›æ–—': [3, 4, 5, 6, 4, 2],
        'è—¤åŸ æ­å¤§': [2, 3, 4, 4, 3, 2], 'å‹æ‰ ç¯¤è¼': [1, 2, 3, 2, 3, 1],
        'å’Œç”° åº·å£«æœ—': [5, 7, 6, 8, 9, 5]
    },
    'å››æ­»çƒ': {
        'å®‰ç”° å°šæ†²': [6, 8, 9, 7, 8, 5], 'ã‚½ãƒˆ': [9, 7, 8, 6, 7, 4],
        'ä¸­æ‘ å¥¨å¾': [4, 5, 6, 5, 6, 4], 'ä½è—¤ éƒ½å¿—ä¹Ÿ': [3, 5, 4, 6, 4, 3]
    }
}

# --- ãƒ•ã‚©ãƒ¼ãƒ è¨­å®š ---
è¡¨ç¤ºé …ç›® = "\u6253\u7387" #@param ["å®‰æ‰“", "æœ¬å¡æ‰“", "æ‰“ç‚¹", "æ‰“ç‡", "ç›—å¡", "å››æ­»çƒ"]
çµ‚äº†æœˆ = 9 #@param {type:"slider", min:4, max:9, step:1}
# --- ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šã“ã“ã¾ã§ ---

def plot_final_stats(target, end_month):
    idx = 1 if end_month <= 4 else end_month - 3
    summary = {p: 0 for p in players}
    if 'å’Œç”° åº·å£«æœ—' not in summary: summary['å’Œç”° åº·å£«æœ—'] = 0

    if target == "æ‰“ç‡":
        # å®Ÿç¸¾ã«åŸºã¥ã„ãŸè¥¿å·é¸æ‰‹ã®æ‰“ç‡.281å‰å¾Œã‚’åŸºæº–ã«æ‰“æ•°ã‚’é€†ç®—
        for p in players:
            h = sum(data['å®‰æ‰“'].get(p, [0]*6)[:idx])
            ab = h / 0.28 if h > 0 else 1 # æš«å®šæ‰“æ•°è¨ˆç®—
            if p == 'è¥¿å· å²ç¤': ab = h / 0.281
            summary[p] = round(h / ab, 3) if h > 0 else 0
        y_label, cm = "é€šç®—æ‰“ç‡", "YlGn"
    else:
        current_data = data.get(target, {})
        for p, vals in current_data.items():
            summary[p] = sum(vals[:idx])
        y_label, cm = f"é€šç®—{target}æ•°", "magma"

    df = pd.DataFrame(list(summary.items()), columns=['é¸æ‰‹å', 'å€¤']).sort_values('å€¤', ascending=False).head(15)

    plt.figure(figsize=(12, 6))
    colors = plt.cm.get_cmap(cm)(np.linspace(0.3, 0.8, len(df)))
    bars = plt.bar(df['é¸æ‰‹å'], df['å€¤'], color=colors, edgecolor='black', alpha=0.8)

    # å·®ã‚’å¼·èª¿
    min_v, max_v = df['å€¤'].min(), df['å€¤'].max()
    plt.ylim(min_v * 0.98 if target == "æ‰“ç‡" else max(0, min_v - 2), max_v * 1.15)

    plt.title(f'2025å¹´ åƒè‘‰ãƒ­ãƒƒãƒ† {end_month}æœˆæ™‚ç‚¹ {target}ãƒ©ãƒ³ã‚­ãƒ³ã‚°', fontsize=16)
    plt.xticks(rotation=45, ha='right')
    plt.grid(axis='y', linestyle=':', alpha=0.6)

    for bar in bars:
        val = bar.get_height()
        label = f'{val:.3f}' if target == "æ‰“ç‡" else f'{int(val)}'
        plt.text(bar.get_x() + bar.get_width()/2., val, label, ha='center', va='bottom', fontsize=10, fontweight='bold')

    plt.tight_layout()
    plt.show()

plot_final_stats(è¡¨ç¤ºé …ç›®, çµ‚äº†æœˆ)
